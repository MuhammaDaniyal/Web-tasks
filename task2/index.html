<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Archery</title>
  <style>

    body { margin: 0; background: #a97f7f; }
    #bow { position: absolute; left: 100px; top: 50%; transform-origin: center center; user-select: none;}
    #test { background-color: orange; position: absolute; top: 0; left: 10px; }
    
    </style>
</head>
<body>
  <img id="bow" src="assets/bow.png">
  
  <canvas id="canvas"></canvas>

  <div id="test">Nigga</div>

  <script>

    const test_div = document.getElementById("test");

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const bow = document.getElementById("bow");
    let dragEnabled = false;

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    
    let angle = 0;
    let bowY = window.innerHeight * 0.5;


    window.addEventListener("mousedown", (e) => {
      dragEnabled = true;
      test_div.innerText = `${dragEnabled}, ${angle}`;
    })

    window.addEventListener("mouseup", (e) => {
      dragEnabled = false;
      angle = 0
      test_div.innerText = `${dragEnabled}, ${angle}`;
      bow.style.transform = `rotate(${angle}rad)`;
    })
    
    // Rotate bow based on mouse position
    window.addEventListener("mousemove", (e) => {
      // Calculate angle between bow and mouse
      const dx = e.clientX - 140; // 140 = bow center x (100 + 40)
      const dy = e.clientY - bowY;
      test_div.innerText = `${dragEnabled}, ${angle}`;
      
    if(dragEnabled && dx < 0)  // Only when mouse is BEHIND bow (left side)
    {
      // Flip the angle to aim AWAY from mouse
      angle = Math.atan2(-dy, -dx) - Math.PI/2;
      bow.style.transform = `rotate(${angle}rad)`;
    }
      
    });    
    
    // Handle resize
    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
    
  </script>
</body>
</html>